<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>mTouch CVD Framework: Custom Hardware Quick Start Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="main.html">main</a>      </li>
      <li><a class="el" href="_getting_started.html">Getting Started</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Custom Hardware Quick Start Guide </h1>  </div>
</div>
<div class="contents">
<dl class="note"><dt><b>Note:</b></dt><dd>This guide assumes you are using custom hardware. For details on where to begin when implementing the mTouch framework on the mTouch CVD Evaluation Kit, use <a class="el" href="_getting_started_eval.html">this guide</a>.</dd></dl>
<h2><a class="anchor" id="GS_SysConfig"></a>
System Configuration</h2>
<p>The <a class="el" href="group__m_touch_a_p_i.html#gaed3afe88efb9865846aabe3520633515" title="Initializes the mTouch CVD firmware.">mTouchCVD_Init()</a> function will automatically configure the ADC, communications module (if enabled), and all required interrupts. There are only a few things the user is required to define on power-up: </p>
<ol>
<li>
Configure the oscillator to provide a fast clock speed. <div class="fragment"><pre class="fragment"> OSCCON = 0b01110000;       <span class="comment">// 32 MHz Fosc w/ PLLEN_ON config word on PIC16F1937</span>
</pre></div> <br/>
 </li>
<li>
Set the TMR0 prescaler. Weak pull-up resistors should be disabled.<br/>
 For more information about the implications of this setting, see <a class="el" href="_resource_requirements.html">Supported PIC&reg; MCUs and Requirements</a>. <div class="fragment"><pre class="fragment"> OPTION_REG = 0b10000000;   <span class="comment">// TMR0 Prescaler = 1:2 (~40% processor usage)</span>
</pre></div> <br/>
 </li>
<li>
Sensor pins should be initialized as digital output low. <div class="fragment"><pre class="fragment"> ANSELA = 0b00000000;       <span class="comment">// Digital</span>
 TRISA  = 0b00000000;       <span class="comment">// Output</span>
 PORTA  = 0b00000000;       <span class="comment">// Low   </span>
</pre></div> </li>
</ol>
<p><br/>
 </p>
<h2><a class="anchor" id="GS_InitConfig"></a>
Framework Configuration</h2>
<p>Open <a class="el" href="m_touch_c_v_d___config_8h.html" title="Main mTouch application configuration file.">mTouchCVD_Config.h</a> and make the following edits: </p>
<ol>
<li>
Set the <a class="el" href="group___configuration.html#ga024148e99a7143db044a48216664d03d" title="The Fosc frequency of your system in Hz.">_XTAL_FREQ</a> value with the PIC&reg; Microcontroller's Fosc speed in Hz <div class="fragment"><pre class="fragment"><span class="preprocessor"> #define _XTAL_FREQ         32000000</span>
</pre></div> <br/>
 </li>
<li>
Set the <a class="el" href="group___configuration.html#ga6cd6eea2b8230a3c984903a5467fb3f1" title="The TMR0 prescaler value of your system.">TMR0_PRESCALER</a> value to the chosen TMR0 prescaler <div class="fragment"><pre class="fragment"><span class="preprocessor"> #define TMR0_PRESCALER     2</span>
</pre></div> <br/>
 </li>
<li>
Set the <a class="el" href="group___configuration.html#ga392407b03210dcc0d87246c8f6911a5b" title="Number of CVD Sensor Inputs.">CVD_NUMBER_SENSORS</a> value to the number of capacitive sensors in your design <div class="fragment"><pre class="fragment"><span class="preprocessor"> #define CVD_NUMBER_SENSORS 5</span>
</pre></div> <br/>
 </li>
<li>
Assign an analog channel to each sensor using the <a class="el" href="group___configuration.html#gaf3b51276b26a7e43c3b476ec266e1cec" title="Analog port assignment for Sensor 0.">CVD_SENSOR0</a> definitions. <div class="fragment"><pre class="fragment"><span class="preprocessor"> #define CVD_SENSOR0        AN0 </span>
<span class="preprocessor"></span><span class="preprocessor"> #define CVD_SENSOR1        AN1    </span>
<span class="preprocessor"></span><span class="preprocessor"> #define CVD_SENSOR2        AN2    </span>
<span class="preprocessor"></span><span class="preprocessor"> #define CVD_SENSOR3        AN3     </span>
<span class="preprocessor"> #define CVD_SENSOR4        AN4   </span>
</pre></div> (Extra definitions - such as <code>CVD_SENSOR5</code>, in this case - will simply be ignored.) </li>
</ol>
<p><br/>
 </p>
<h2><a class="anchor" id="GS_API"></a>
Application Main Loop API Hooks</h2>
<p>In your application's main loop: </p>
<ol>
<li>
Use the <a class="el" href="group__m_touch_a_p_i.html#gaead986ac2d0754d25575559936191d7c" title="Returns a non-zero value when a new set of readings is ready for processing.">mTouchCVD_isDataReady()</a> function to determine when to service new mTouch readings. </li>
<li>
Once it's set, call <a class="el" href="group__m_touch_a_p_i.html#ga1d7fa7d0b8d4351df46708ddf49401b1" title="Services a new set of results from the acquisition module.">mTouchCVD_Service()</a>. The <a class="el" href="group___acquisition.html#gaf57e5702190e3129a5e620dce0fa9d91" title="GLOBAL: Flag to determine if new data is ready for processing.">mTouchCVD_dataReady</a> state is reset automatically. <div class="fragment"><pre class="fragment"> <span class="keywordflow">while</span>(1)
 {
   <span class="keywordflow">if</span> (<a class="code" href="group__m_touch_a_p_i.html#gaead986ac2d0754d25575559936191d7c" title="Returns a non-zero value when a new set of readings is ready for processing.">mTouchCVD_isDataReady</a>())   <span class="comment">// Is new information ready?</span>
   {
      <a class="code" href="group__m_touch_a_p_i.html#ga1d7fa7d0b8d4351df46708ddf49401b1" title="Services a new set of results from the acquisition module.">mTouchCVD_Service</a>();        <span class="comment">// Decode the newly captured data and transmit new data updates.</span>
   }
 }
</pre></div> <br/>
 </li>
<li>
Use <a class="el" href="group__m_touch_a_p_i.html#ga2744263b0a408acff07e51bc60cb2691" title="Returns the state of the requested sensor.">CVD_GetButtonState(i)</a> to perform actions based on the sensor's state. (<b>See also</b>: <a class="el" href="m_touch_c_v_d_8h.html#ab5f3b598c7aa9cfcc773f1a215276ee6" title="GLOBAL: ButtonState valid values.">CVD_ButtonState</a>) <div class="fragment"><pre class="fragment"><span class="preprocessor"> #define LED0      LATA0</span>
<span class="preprocessor"></span>
<span class="preprocessor"> #define LED_ON    0</span>
<span class="preprocessor"></span><span class="preprocessor"> #define LED_OFF   1</span>
<span class="preprocessor"></span>
 <span class="keywordflow">if</span> (<a class="code" href="group__m_touch_a_p_i.html#ga2744263b0a408acff07e51bc60cb2691" title="Returns the state of the requested sensor.">CVD_GetButtonState</a>(0) &lt; <a class="code" href="m_touch_c_v_d_8h.html#ab5f3b598c7aa9cfcc773f1a215276ee6a1bd1fe32b9c78ff9c0a008aae0d8d00c" title="Sensor is currently pressed.">CVD_PRESSED</a>)
 { 
   LED0 = LED_OFF;                <span class="comment">// Sensor is either initializing or released.</span>
 } <span class="keywordflow">else</span> { 
   LED0 = LED_ON;                 <span class="comment">// Sensor is pressed.</span>
 } 
</pre></div> </li>
</ol>
<p>Your application should now compile and function. If you have enabled communications, you can see the real-time sensor readings using the mTouch CVD Framework GUI. For more information about adjusting the thresholds on sensors and further customizations, refer to the other <a class="el" href="_getting_started.html">Getting Started</a> guides. </p>
</div>
<hr class="footer"/><address class="footer"><small>mTouch CVD Framework v1.1 documentation by&#160;
<a href="http://www.microchip.com"> 
<img class="footer" src="../includes/mchp.jpeg" alt="Click here to visit our website at www.microchip.com"/></a></small></address> 
</body> 
</html> 
